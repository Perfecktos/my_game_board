<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>–ü—Ä–æ–±–∫–æ–≤–∞—è –¥–æ—Å–∫–∞ ¬∑ –ú–æ–∏ –∏–≥—Ä—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cabin Sketch', cursive, sans-serif;
        }

        body {
            min-height: 100vh;
            background: #1f2a38;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }

        .corkboard {
            width: 100%;
            max-width: 1600px;
            background-color: #8b5a2b;
            background-image: 
                radial-gradient(circle at 10px 20px, #6b3e1a 4px, transparent 4px),
                radial-gradient(circle at 30px 50px, #6b3e1a 5px, transparent 5px),
                radial-gradient(circle at 70px 15px, #6b3e1a 3px, transparent 3px),
                radial-gradient(circle at 45px 80px, #6b3e1a 6px, transparent 6px),
                radial-gradient(circle at 90px 40px, #6b3e1a 4px, transparent 4px),
                radial-gradient(circle at 5px 95px, #6b3e1a 5px, transparent 5px),
                radial-gradient(circle at 110px 70px, #6b3e1a 3px, transparent 3px);
            background-size: 140px 140px;
            border-radius: 40px 40px 30px 30px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.4), 0 20px 30px rgba(0,0,0,0.6);
            padding: 40px 35px;
            border: 8px solid #5a3a1e;
            position: relative;
            margin: 20px 0;
        }

        .corkboard::before {
            content: '';
            position: absolute;
            top: -16px;
            left: 30px;
            right: 30px;
            height: 22px;
            background: linear-gradient(180deg, #c69c6d, #8b5a2b);
            border-radius: 40px 40px 0 0;
            box-shadow: 0 -3px 6px rgba(0,0,0,0.3);
            border-bottom: 3px solid #5a3a1e;
        }

        .board-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            background: rgba(44, 26, 12, 0.5);
            backdrop-filter: blur(3px);
            padding: 20px 30px;
            border-radius: 60px;
            border: 2px dashed #dbb48b;
        }

        .title-container {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            flex-wrap: wrap;
        }

        .board-header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: #f7e9d7;
            text-shadow: 4px 4px 0 #4d2e14, 6px 6px 0 #2f1b0f;
            letter-spacing: 1.5px;
            word-break: break-word;
        }

        .edit-title-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #f7e9d7;
            text-shadow: 2px 2px 0 #4d2e14;
            cursor: pointer;
            opacity: 0.6;
            transition: 0.2s;
            padding: 5px;
            line-height: 1;
        }

        .edit-title-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .title-input {
            font-size: 2.2rem;
            font-weight: 700;
            background: #fffcf0;
            border: 3px solid #b55a3a;
            border-radius: 20px;
            padding: 10px 20px;
            color: #2e2112;
            width: 100%;
            max-width: 500px;
            outline: none;
            font-family: inherit;
        }

        .add-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            background: #e8d6b5;
            padding: 15px 25px;
            border-radius: 60px;
            box-shadow: inset 0 2px 8px #7b5e3b, 0 7px 0 #5a3a1e;
            width: fit-content;
            max-width: 100%;
        }

        .form-fields {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .add-form input {
            padding: 14px 22px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            background: #fffcf0;
            box-shadow: inset 0 3px 6px rgba(0,0,0,0.1);
            min-width: 200px;
            outline: none;
            border: 2px solid transparent;
            transition: 0.15s;
            flex: 1 1 auto;
        }

        .add-form input:focus {
            border-color: #b55a3a;
        }

        .add-form .url-field,
        .add-form .cover-field {
            min-width: 220px;
        }

        .add-form button {
            background: #d48d5c;
            border: none;
            color: white;
            font-weight: bold;
            font-size: 1.3rem;
            padding: 14px 30px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #7b4a2b, 0 8px 12px rgba(0,0,0,0.2);
            transition: 0.05s linear;
            border: 1px solid #f5c9a0;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .add-form button:active {
            transform: translateY(6px);
            box-shadow: 0 1px 0 #7b4a2b, 0 4px 10px rgba(0,0,0,0.2);
        }

        /* –ü–∞–Ω–µ–ª—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è */
        .zoom-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0 20px 0;
            background: rgba(44, 26, 12, 0.5);
            backdrop-filter: blur(3px);
            padding: 10px 20px;
            border-radius: 40px;
            border: 2px dashed #dbb48b;
            width: fit-content;
        }

        .zoom-label {
            color: #f7e9d7;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 2px 2px 0 #4d2e14;
        }

        .zoom-slider {
            width: 200px;
            height: 8px;
            background: #dbb48b;
            border-radius: 10px;
            -webkit-appearance: none;
            appearance: none;
        }

        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: #f7e9d7;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            border: 2px solid #b55a3a;
        }

        .zoom-value {
            color: #f7e9d7;
            font-size: 1.2rem;
            min-width: 50px;
            text-align: center;
            text-shadow: 2px 2px 0 #4d2e14;
        }

        .stickers-container {
            position: relative;
            width: 100%;
            min-height: 400px;
            height: auto;
            border-radius: 20px;
            overflow: auto;
            padding: 10px;
            transition: height 0.2s ease;
        }

        .sticker {
            position: absolute;
            width: 280px;
            min-height: 340px;
            background: #fffeeb;
            background: linear-gradient(145deg, #ffffdd, #fff3b0);
            border-radius: 12px 20px 20px 12px;
            padding: 25px 15px 18px 15px;
            box-shadow: 
                0 14px 16px rgba(0,0,0,0.3),
                0 3px 0 #bba87f inset,
                0 -3px 0 #efe0b0 inset;
            border-left: 5px solid #e3c184;
            border-bottom: 5px solid #dbb16b;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: grab;
            user-select: none;
            touch-action: none;
            z-index: 10;
            /* –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∞ –∏ –ø–æ–≤–æ—Ä–æ—Ç–∞ –±—É–¥–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å—Å—è –∏–Ω–ª–∞–π–Ω */
            transform-origin: center center;
        }

        .sticker.dragging {
            cursor: grabbing;
            opacity: 0.9;
            z-index: 1000;
            box-shadow: 0 20px 25px rgba(0,0,0,0.5);
            transition: none;
        }

        .sticker:nth-child(odd) {
            background: linear-gradient(145deg, #e5f3ff, #c7e2f2);
            border-left-color: #9fbddb;
            border-bottom-color: #87a9cc;
        }
        .sticker:nth-child(3n) {
            background: linear-gradient(145deg, #f0e0ff, #ddc7f0);
            border-left-color: #ba9fd1;
            border-bottom-color: #a07fc9;
        }
        .sticker:nth-child(5n+2) {
            background: linear-gradient(145deg, #ffdede, #ffc7c7);
            border-left-color: #e6a2a2;
            border-bottom-color: #d18686;
        }

        .sticker .pin {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 32px;
            background: radial-gradient(circle at 35% 35%, #f7f7f7, #a0a0a0);
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4), inset -3px -3px 4px #5a5a5a;
            border: 2px solid #c0c0c0;
            z-index: 3;
            pointer-events: none;
        }
        .sticker .pin::after {
            content: '';
            position: absolute;
            top: 6px;
            left: 7px;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #fff 30%, #ccc 80%);
            border-radius: 50%;
        }

        .cover-wrapper {
            width: 100%;
            height: 150px;
            margin: 5px 0 12px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.05);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            pointer-events: none;
        }

        .cover-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            pointer-events: none;
        }

        .cover-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #cfb595;
            color: #4f3a24;
            font-weight: bold;
            font-size: 1.2rem;
            gap: 5px;
            pointer-events: none;
            text-align: center;
            padding: 10px;
        }
        .cover-placeholder span {
            font-size: 2rem;
        }

        .sticker .game-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2e2112;
            text-align: center;
            margin: 10px 0 6px;
            text-shadow: 2px 2px 0 rgba(255,255,200,0.7);
            font-family: 'Cabin Sketch', 'Comic Sans MS', cursive;
            line-height: 1.2;
            word-break: break-word;
            max-width: 100%;
            pointer-events: none;
        }

        .store-badge {
            font-size: 0.9rem;
            background: rgba(0,0,0,0.1);
            padding: 4px 10px;
            border-radius: 30px;
            margin-bottom: 8px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            border: 1px solid rgba(0,0,0,0.2);
            pointer-events: none;
        }

        .delete-btn {
            background: #c04a3a;
            border: none;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            width: 42px;
            height: 42px;
            border-radius: 50% 50% 5px 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 0 #6d2f23, 0 3px 10px rgba(0,0,0,0.2);
            transition: 0.05s linear;
            margin-top: 8px;
            align-self: flex-end;
            border: 1px solid #f0b9a0;
            pointer-events: auto;
            z-index: 20;
        }

        .delete-btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #6d2f23, 0 3px 6px rgba(0,0,0,0.2);
        }

        .delete-btn:hover {
            background: #b22f1d;
        }

        .empty-message {
            width: 100%;
            text-align: center;
            font-size: 2.5rem;
            color: #eedbbc;
            text-shadow: 3px 3px 0 #4a2e16;
            padding: 80px 20px;
            background: rgba(0,0,0,0.15);
            border-radius: 100px;
            border: 3px dashed #cfb187;
            backdrop-filter: blur(2px);
            font-style: italic;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 900px) {
            .board-header {
                flex-direction: column;
                align-items: stretch;
            }
            .board-header h1 {
                font-size: 2.2rem;
                text-align: center;
            }
            .title-container {
                justify-content: center;
            }
            .add-form {
                flex-direction: column;
                align-items: stretch;
                width: 100%;
                padding: 15px;
            }
            .form-fields {
                flex-direction: column;
            }
            .add-form input {
                width: 100%;
                min-width: auto;
            }
            .add-form button {
                width: 100%;
            }
            .zoom-control {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 600px) {
            .corkboard {
                padding: 25px 15px;
            }
            .board-header h1 {
                font-size: 1.8rem;
            }
            .sticker {
                width: 220px;
                min-height: 280px;
                padding: 20px 10px 15px;
            }
            .cover-wrapper {
                height: 120px;
            }
            .sticker .game-title {
                font-size: 1.2rem;
            }
            .delete-btn {
                width: 36px;
                height: 36px;
                font-size: 1.2rem;
            }
            .empty-message {
                font-size: 1.8rem;
                padding: 40px 15px;
            }
            .zoom-slider {
                width: 150px;
            }
        }

        @media (max-width: 400px) {
            .sticker {
                width: 180px;
                min-height: 240px;
            }
            .cover-wrapper {
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="corkboard">
        <div class="board-header">
            <div class="title-container" id="titleContainer">
                <h1 id="boardTitleDisplay">üéÆ –ú–û–ò –ò–ì–†–´</h1>
                <button class="edit-title-btn" id="editTitleBtn" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏">‚úé</button>
            </div>
            <div class="add-form">
                <div class="form-fields">
                    <input type="text" id="gameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã" maxlength="60" autocomplete="off">
                    <input type="url" id="urlInput" class="url-field" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ Steam/Epic" autocomplete="off">
                    <input type="url" id="coverInput" class="cover-field" placeholder="–°–≤–æ—è –æ–±–ª–æ–∂–∫–∞ (—Å—Å—ã–ª–∫–∞)" autocomplete="off">
                </div>
                <button id="addBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="zoom-control">
            <span class="zoom-label">üîç –ú–∞—Å—à—Ç–∞–±:</span>
            <input type="range" id="zoomSlider" class="zoom-slider" min="0.5" max="2" step="0.1" value="1">
            <span id="zoomValue" class="zoom-value">100%</span>
        </div>

        <div id="stickersContainer" class="stickers-container">
            <!-- —Å—Ç–∏–∫–µ—Ä—ã -->
        </div>
    </div>

    <script>
        (function() {
            const STORAGE_KEY = 'playedGamesBoardV6';
            const TITLE_STORAGE_KEY = 'corkboardTitle';
            const ZOOM_STORAGE_KEY = 'corkboardZoom';

            // –≠–ª–µ–º–µ–Ω—Ç—ã
            const titleContainer = document.getElementById('titleContainer');
            const titleDisplay = document.getElementById('boardTitleDisplay');
            const editTitleBtn = document.getElementById('editTitleBtn');
            const container = document.getElementById('stickersContainer');
            const gameInput = document.getElementById('gameInput');
            const urlInput = document.getElementById('urlInput');
            const coverInput = document.getElementById('coverInput');
            const addButton = document.getElementById('addBtn');
            const zoomSlider = document.getElementById('zoomSlider');
            const zoomValue = document.getElementById('zoomValue');

            let games = [];
            let currentScale = 1.0;

            // ========== –ó–∞–≥–æ–ª–æ–≤–æ–∫ ==========
            function loadTitle() {
                const savedTitle = localStorage.getItem(TITLE_STORAGE_KEY);
                if (savedTitle) {
                    titleDisplay.textContent = savedTitle;
                } else {
                    titleDisplay.textContent = 'üéÆ –ú–û–ò –ò–ì–†–´';
                }
            }

            function saveTitle(newTitle) {
                localStorage.setItem(TITLE_STORAGE_KEY, newTitle);
            }

            function enableTitleEditing() {
                const currentText = titleDisplay.textContent;
                const input = document.createElement('input');
                input.type = 'text';
                input.value = currentText;
                input.className = 'title-input';
                input.maxLength = 50;

                titleContainer.innerHTML = '';
                titleContainer.appendChild(input);
                input.focus();
                input.select();

                function saveNewTitle() {
                    const newText = input.value.trim() || 'üéÆ –ú–æ—è –¥–æ—Å–∫–∞';
                    titleDisplay.textContent = newText;
                    saveTitle(newText);

                    titleContainer.innerHTML = '';
                    titleContainer.appendChild(titleDisplay);
                    titleContainer.appendChild(editTitleBtn);
                }

                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        saveNewTitle();
                    }
                });

                input.addEventListener('blur', saveNewTitle);
            }

            editTitleBtn.addEventListener('click', enableTitleEditing);
            titleDisplay.addEventListener('dblclick', enableTitleEditing);

            // ========== –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ ==========
            function loadZoom() {
                const savedZoom = localStorage.getItem(ZOOM_STORAGE_KEY);
                if (savedZoom) {
                    currentScale = parseFloat(savedZoom);
                    if (isNaN(currentScale) || currentScale < 0.5) currentScale = 1.0;
                    if (currentScale > 2) currentScale = 2.0;
                } else {
                    currentScale = 1.0;
                }
                zoomSlider.value = currentScale;
                zoomValue.textContent = Math.round(currentScale * 100) + '%';
                applyZoomToStickers();
            }

            function saveZoom(scale) {
                localStorage.setItem(ZOOM_STORAGE_KEY, scale.toString());
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∞—Å—à—Ç–∞–± –∫–æ –≤—Å–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Å—Ç–∏–∫–µ—Ä–∞–º
            function applyZoomToStickers() {
                const stickers = document.querySelectorAll('.sticker');
                stickers.forEach(sticker => {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ–≤–æ—Ä–æ—Ç (–∏–∑ dataset –∏–ª–∏ –≤—ã—á–∏—Å–ª—è–µ–º)
                    let rot = sticker.dataset.rot || '0deg';
                    sticker.style.transform = `scale(${currentScale}) rotate(${rot})`;
                });
                // –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                setTimeout(updateContainerSize, 10);
            }

            zoomSlider.addEventListener('input', (e) => {
                currentScale = parseFloat(e.target.value);
                zoomValue.textContent = Math.round(currentScale * 100) + '%';
                applyZoomToStickers();
                saveZoom(currentScale);
            });

            // ========== –ò–≥—Ä—ã ==========
            function loadFromStorage() {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    try {
                        games = JSON.parse(stored);
                        if (!Array.isArray(games)) games = [];
                        games = games.filter(g => g && typeof g === 'object' && g.title && g.id);
                        games.forEach(g => {
                            if (typeof g.posX === 'undefined') g.posX = 2 + Math.random() * 40;
                            if (typeof g.posY === 'undefined') g.posY = 2 + Math.random() * 40;
                        });
                    } catch (e) {
                        games = [];
                    }
                } else {
                    games = [
                        { 
                            id: Date.now() - 50000, 
                            title: 'The Witcher 3', 
                            url: 'https://store.steampowered.com/app/292030/The_Witcher_3_Wild_Hunt/',
                            storeType: 'steam',
                            storeId: '292030',
                            posX: 2, posY: 3
                        },
                        { 
                            id: Date.now() - 40000, 
                            title: 'Hades', 
                            url: 'https://store.steampowered.com/app/1145360/Hades/',
                            storeType: 'steam',
                            storeId: '1145360',
                            posX: 25, posY: 10
                        },
                        { 
                            id: Date.now() - 30000, 
                            title: 'Rocket League', 
                            url: 'https://store.epicgames.com/ru/p/rocket-league',
                            storeType: 'epic',
                            storeId: 'rocket-league',
                            posX: 50, posY: 25
                        }
                    ];
                }
            }

            function saveToStorage() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(games));
            }

            function parseStoreInfo(url) {
                if (!url || typeof url !== 'string') return { type: null, id: null };
                try {
                    const urlObj = new URL(url);
                    const host = urlObj.hostname.replace('www.', '');
                    
                    if (host.includes('steampowered.com') && urlObj.pathname.includes('/app/')) {
                        const match = urlObj.pathname.match(/\/app\/(\d+)/);
                        if (match && match[1]) {
                            return { type: 'steam', id: match[1] };
                        }
                    }
                    
                    if (host.includes('epicgames.com')) {
                        let match = urlObj.pathname.match(/\/p\/([^\/]+)/);
                        if (!match) match = urlObj.pathname.match(/\/product\/([^\/]+)/);
                        if (match && match[1]) {
                            return { type: 'epic', id: match[1] };
                        }
                    }
                } catch (e) {}
                return { type: null, id: null };
            }

            function getAutoCoverUrl(storeType, id) {
                if (storeType === 'steam' && id) {
                    return `https://cdn.cloudflare.steamstatic.com/steam/apps/${id}/header.jpg`;
                }
                if (storeType === 'epic' && id) {
                    return `https://cdn1.epicgames.com/${id}/offer/${id}_egs_icon.jpg`;
                }
                return null;
            }

            function createPlaceholder(storeType) {
                const div = document.createElement('div');
                div.className = 'cover-placeholder';
                if (storeType === 'steam') {
                    div.innerHTML = '<span>üü¶</span> Steam';
                } else if (storeType === 'epic') {
                    div.innerHTML = '<span>üü®</span> Epic';
                } else {
                    div.innerHTML = '<span>üì¶</span> –Ω–µ—Ç –æ–±–ª–æ–∂–∫–∏';
                }
                return div;
            }

            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ —Å–∞–º–æ–º—É –Ω–∏–∂–Ω–µ–º—É –∏ —Å–∞–º–æ–º—É –ø—Ä–∞–≤–æ–º—É —Å—Ç–∏–∫–µ—Ä—É
            function updateContainerSize() {
                const stickers = document.querySelectorAll('.sticker');
                if (stickers.length === 0) {
                    container.style.height = '400px';
                    container.style.width = '100%'; // —à–∏—Ä–∏–Ω–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ –æ—Å—Ç–∞–≤–∏–º
                    return;
                }

                const containerRect = container.getBoundingClientRect();
                let maxBottom = 0;
                let maxRight = 0;

                stickers.forEach(sticker => {
                    const rect = sticker.getBoundingClientRect();
                    const bottom = rect.bottom - containerRect.top;
                    const right = rect.right - containerRect.left;
                    if (bottom > maxBottom) maxBottom = bottom;
                    if (right > maxRight) maxRight = right;
                });

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É (—á—Ç–æ–±—ã –≤–º–µ—Å—Ç–∏—Ç—å —Å–∞–º—ã–π –ø—Ä–∞–≤—ã–π)
                const newHeight = Math.max(400, maxBottom + 30);
                container.style.height = newHeight + 'px';
                // –®–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —Ç–∞–∫ 100%, –Ω–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ, –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å min-width
                // –û–¥–Ω–∞–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–∂–µ –∏–º–µ–µ—Ç overflow: auto, –ø–æ—ç—Ç–æ–º—É –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏,
                // –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç —à–∏—Ä–µ. –ù–µ –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å —à–∏—Ä–∏–Ω—É.
                // –ü—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ padding –Ω–µ –º–µ—à–∞–µ—Ç
            }

            function createStickerElement(game) {
                const sticker = document.createElement('div');
                sticker.className = 'sticker';
                sticker.dataset.id = game.id;

                sticker.style.left = (game.posX || 5) + '%';
                sticker.style.top = (game.posY || 5) + '%';

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç (–º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π)
                const rot = (Math.random() * 5 - 2.5).toFixed(1) + 'deg';
                sticker.dataset.rot = rot; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤–º–µ—Å—Ç–µ —Å –º–∞—Å—à—Ç–∞–±–æ–º
                sticker.style.transform = `scale(${currentScale}) rotate(${rot})`;

                const pin = document.createElement('div');
                pin.className = 'pin';

                const coverWrapper = document.createElement('div');
                coverWrapper.className = 'cover-wrapper';

                let coverUrl = game.customCover || null;
                if (!coverUrl && game.storeType && game.storeId) {
                    coverUrl = getAutoCoverUrl(game.storeType, game.storeId);
                }

                if (coverUrl) {
                    const img = document.createElement('img');
                    img.className = 'cover-image';
                    img.src = coverUrl;
                    img.alt = game.title;
                    img.loading = 'lazy';
                    img.onerror = () => {
                        img.style.display = 'none';
                        const placeholder = createPlaceholder(game.storeType);
                        coverWrapper.appendChild(placeholder);
                    };
                    coverWrapper.appendChild(img);
                } else {
                    coverWrapper.appendChild(createPlaceholder(game.storeType));
                }

                const titleDiv = document.createElement('div');
                titleDiv.className = 'game-title';
                titleDiv.textContent = game.title;

                if (game.storeType) {
                    const badge = document.createElement('div');
                    badge.className = 'store-badge';
                    badge.innerHTML = game.storeType === 'steam' ? 'üü¶ Steam' : 'üü® Epic Games';
                    sticker.appendChild(badge);
                }

                const delBtn = document.createElement('button');
                delBtn.className = 'delete-btn';
                delBtn.innerHTML = '‚úï';
                delBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteGame(game.id);
                });

                sticker.appendChild(pin);
                sticker.appendChild(coverWrapper);
                sticker.appendChild(titleDiv);
                sticker.appendChild(delBtn);

                makeStickerDraggable(sticker, game.id);

                return sticker;
            }

            function makeStickerDraggable(sticker, gameId) {
                let isDragging = false;
                let startX, startY, startPercentX, startPercentY;

                function onMouseDown(e) {
                    if (e.target.classList.contains('delete-btn')) return;
                    e.preventDefault();

                    const startLeftStr = sticker.style.left;
                    const startTopStr = sticker.style.top;
                    startPercentX = parseFloat(startLeftStr) || 5;
                    startPercentY = parseFloat(startTopStr) || 5;

                    startX = e.clientX;
                    startY = e.clientY;

                    isDragging = true;
                    sticker.classList.add('dragging');

                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                }

                function onMouseMove(e) {
                    if (!isDragging) return;
                    e.preventDefault();

                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;

                    const containerW = container.clientWidth;
                    const containerH = container.clientHeight;

                    // –°–º–µ—â–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö —Å —É—á—ë—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞
                    const deltaPercentX = dx / (containerW * currentScale) * 100;
                    const deltaPercentY = dy / (containerH * currentScale) * 100;

                    let newLeft = startPercentX + deltaPercentX;
                    let newTop = startPercentY + deltaPercentY;

                    newLeft = Math.min(95, Math.max(0, newLeft));
                    newTop = Math.min(95, Math.max(0, newTop));

                    sticker.style.left = newLeft + '%';
                    sticker.style.top = newTop + '%';
                }

                function onMouseUp(e) {
                    if (isDragging) {
                        isDragging = false;
                        sticker.classList.remove('dragging');

                        const game = games.find(g => g.id === gameId);
                        if (game) {
                            game.posX = parseFloat(sticker.style.left);
                            game.posY = parseFloat(sticker.style.top);
                            saveToStorage();
                            updateContainerSize();
                        }

                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    }
                }

                sticker.addEventListener('mousedown', onMouseDown);

                // –¢–∞—á-—Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                sticker.addEventListener('touchstart', (e) => {
                    if (e.target.classList.contains('delete-btn')) return;
                    e.preventDefault();
                    const touch = e.touches[0];
                    startPercentX = parseFloat(sticker.style.left) || 5;
                    startPercentY = parseFloat(sticker.style.top) || 5;
                    startX = touch.clientX;
                    startY = touch.clientY;
                    isDragging = true;
                    sticker.classList.add('dragging');
                }, { passive: false });

                sticker.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const touch = e.touches[0];
                    const dx = touch.clientX - startX;
                    const dy = touch.clientY - startY;
                    const containerW = container.clientWidth;
                    const containerH = container.clientHeight;
                    const deltaPercentX = dx / (containerW * currentScale) * 100;
                    const deltaPercentY = dy / (containerH * currentScale) * 100;
                    let newLeft = startPercentX + deltaPercentX;
                    let newTop = startPercentY + deltaPercentY;
                    newLeft = Math.min(95, Math.max(0, newLeft));
                    newTop = Math.min(95, Math.max(0, newTop));
                    sticker.style.left = newLeft + '%';
                    sticker.style.top = newTop + '%';
                }, { passive: false });

                sticker.addEventListener('touchend', (e) => {
                    if (isDragging) {
                        isDragging = false;
                        sticker.classList.remove('dragging');
                        const game = games.find(g => g.id === gameId);
                        if (game) {
                            game.posX = parseFloat(sticker.style.left);
                            game.posY = parseFloat(sticker.style.top);
                            saveToStorage();
                            updateContainerSize();
                        }
                    }
                });
            }

            function deleteGame(id) {
                games = games.filter(g => g.id !== id);
                saveToStorage();
                renderBoard();
            }

            function addGame(title, storeUrl, coverUrl) {
                if (!title.trim()) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã');
                    return false;
                }
                title = title.trim().slice(0, 60);

                const storeInfo = parseStoreInfo(storeUrl);

                const posX = 2 + Math.random() * 85;
                const posY = 2 + Math.random() * 85;

                const newGame = {
                    id: Date.now() + Math.floor(Math.random() * 10000),
                    title: title,
                    url: storeUrl && storeUrl.trim() ? storeUrl.trim() : null,
                    customCover: coverUrl && coverUrl.trim() ? coverUrl.trim() : null,
                    storeType: storeInfo.type,
                    storeId: storeInfo.id,
                    posX: posX,
                    posY: posY
                };
                games.push(newGame);
                saveToStorage();
                renderBoard();
                return true;
            }

            function renderBoard() {
                container.innerHTML = '';

                if (games.length === 0) {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.className = 'empty-message';
                    emptyMsg.textContent = 'üìå –ü—Ä–∏–∫—Ä–µ–ø–∏ –∏–≥—Ä—É...';
                    container.appendChild(emptyMsg);
                    container.style.height = '400px';
                } else {
                    games.sort((a, b) => b.id - a.id);
                    games.forEach(game => {
                        const sticker = createStickerElement(game);
                        container.appendChild(sticker);
                    });
                    setTimeout(updateContainerSize, 10);
                }
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadTitle();
            loadFromStorage();
            loadZoom(); // –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä –ø—Ä–∏–º–µ–Ω–∏—Ç –º–∞—Å—à—Ç–∞–± –∫ —Å—Ç–∏–∫–µ—Ä–∞–º
            renderBoard();

            addButton.addEventListener('click', () => {
                if (gameInput.value.trim() !== '') {
                    addGame(gameInput.value, urlInput.value, coverInput.value);
                    gameInput.value = '';
                    urlInput.value = '';
                    coverInput.value = '';
                    gameInput.focus();
                } else {
                    alert('–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã!');
                }
            });

            gameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addButton.click();
                }
            });

            window.addEventListener('storage', (e) => {
                if (e.key === STORAGE_KEY) {
                    loadFromStorage();
                    renderBoard();
                }
                if (e.key === TITLE_STORAGE_KEY) {
                    loadTitle();
                }
                if (e.key === ZOOM_STORAGE_KEY) {
                    loadZoom();
                }
            });

            window.addEventListener('resize', () => {
                updateContainerSize();
            });
        })();
    </script>
</body>
</html>
